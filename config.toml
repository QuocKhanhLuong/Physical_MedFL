# Flower Federated Learning Configuration
# Optimized for Medical Segmentation Convergence

[tool.flwr.app.config]
# Server Configuration
num-rounds = 15         # More rounds with lower learning rate
round-timeout = 600

# FedAdam Strategy Parameters (Optimized for Medical Data)
eta = 0.001             # Server-side learning rate (reduced for stability)
eta-l = 0.0001          # Client-side learning rate (reduced to prevent overshooting)
beta-1 = 0.9            # Momentum parameter
beta-2 = 0.99           # Second moment parameter
tau = 1e-9              # Adaptability control parameter

# Client Selection
fraction-fit = 1.0
fraction-evaluate = 1.0
min-fit-clients = 1
min-evaluate-clients = 1

# Medical Domain Adaptations (Simplified for better convergence)
noise-adaptation = false      # Disabled initially for stable convergence
physics-scheduling = false    # Disabled to focus on segmentation loss
progressive-complexity = false # Disabled to avoid training complexity

# Training Configuration (Optimized for Medical Segmentation)
local-epochs = 3        # Reduced to prevent client overfitting
batch-size = 4          # Smaller batch size for medical data
test-batch-size = 2     # Smaller test batch size
weight-decay = 1e-5

# Data Configuration
num-classes = 4
img-size = 256

# Evaluation
enable-global-evaluation = true

[tool.flwr.federations]
default = "local-simulation"

[tool.flwr.federations.local-simulation]
options.num-supernodes = 2 